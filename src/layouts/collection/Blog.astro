---
import TextContainer from 'src/components/TextContainer.astro'
import { getEntryPath, type ProcessedEntry } from 'src/util/collection.ts'
import Banner from 'src/components/Banner.astro'
import ImageGallery from 'src/components/ImageGallery.astro'
import BlogSidebar from 'src/components/blog/BlogSidebar.astro'
import FlexGridContainer from 'src/components/FlexGridContainer.astro'
import GigTile from 'src/components/gig/GigTile.astro'
import Player from 'src/components/gig/Player'
import Image from 'src/components/blog/BlogImage.astro'
import SidebarNav from 'src/components/SidebarNav.astro'
import ChevronLeftIcon from '~icons/bx/chevron-left'
import { backButton } from 'src/components/gig/GigsMenu.css'
import ImageGalleryLightbox from 'src/components/ImageGalleryLightbox'
import type { ResponsiveImage } from 'src/util/ResponsiveImage'

interface Props {
	entry: ProcessedEntry<'blog'>
}
const { entry } = Astro.props

const { Content, headings, remarkPluginFrontmatter } = await entry.entry.render()

const entryData = entry.entry.data
const entryExtra = entry.extra

const responsiveImages: ResponsiveImage[] = Object.values(remarkPluginFrontmatter.responsiveImages)
---

{entryExtra.cover && <Banner backgroundImage={entryExtra.cover} title={entryData.title} />}
<div style={{ display: 'flex', maxWidth: '1600px', margin: '0 auto' }}>
	<BlogSidebar className="hideMobile" entry={entry} />
	<TextContainer>
		<Content components={{ Player, Image }} />
	</TextContainer>
</div>
<div class="showMobile">
	<SidebarNav customButton={true}>
		<BlogSidebar slot="sidebarMenu" entry={entry} />
		<a slot="sidebarSubheaderTopMobile" class={`showMobile flex ${backButton}`} href="/blog">
			<ChevronLeftIcon /> Go to blogs home
		</a>
	</SidebarNav>
</div>
{entryData.gallery && entryExtra.images && <ImageGallery images={Object.values(entryExtra.images)} />}
<div class="padding">
	<hr />
	<ul>
		{
			entry.prev && (
				<li>
					<a href={getEntryPath(entry.prev.data.title, 'blog')} rel="prev">
						← {entry.prev.data.title}
					</a>
				</li>
			)
		}
		{
			entry.next && (
				<li>
					<a href={getEntryPath(entry.next.data.title, 'blog')} rel="next">
						{entry.next.data.title} →
					</a>
				</li>
			)
		}
	</ul>
	{!!entryExtra.relatedGigs.length && <h2>Related Gigs</h2>}
</div>
{
	!!entryExtra.relatedGigs.length && (
		<FlexGridContainer>
			{entryExtra.relatedGigs.map((entry) => (
				<GigTile gig={entry} />
			))}
		</FlexGridContainer>
	)
}
<ImageGalleryLightbox images={responsiveImages} client:load/>
