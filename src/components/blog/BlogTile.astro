---
/**
 * A regular tile but pre-filled with blog metadata.
 */
import { processEntry, type ProcessedEntry } from 'src/util/collection'
import Tile, { type BackgroundStyle } from '../Tile.astro'
import type { ResponsiveImageSizes } from '../Image2.astro'
import { tagLink } from './BlogTags.css'
import { formattedDate } from 'src/util/names'
import FastArrowRight from '~icons/iconoir/fast-arrow-right'
import type { CollectionEntry } from 'astro:content'

interface Props {
	blog: CollectionEntry<'blog'> | ProcessedEntry<'blog'>
	containerHeight?: string
	containerHeightMobile?: string
	responsiveImageSizes?: keyof ResponsiveImageSizes
	backgroundStyle?: BackgroundStyle
}

const { blog, containerHeight, containerHeightMobile, backgroundStyle, responsiveImageSizes } = Astro.props

// Type guard: ProcessedEntry has an 'extra' property, CollectionEntry doesn't
const isProcessedEntry = (entry: CollectionEntry<'blog'> | ProcessedEntry<'blog'>): entry is ProcessedEntry<'blog'> => {
	return 'extra' in entry
}

const processedEntry: ProcessedEntry<'blog'> = isProcessedEntry(blog) ? blog : await processEntry(blog)
const blogData = processedEntry.entry.data
const blogExtra = processedEntry.extra
---

<Tile
	title={`ARTICLE: ${blogData.title}`}
	label={formattedDate(blogData.date)}
	href={blogExtra.absolutePath}
	responsiveImage={blogExtra.cover}
	responsiveImageSizes={responsiveImageSizes}
	backgroundStyle={backgroundStyle}
	containerHeight={containerHeight}
	containerHeightMobile={containerHeightMobile}
>
	{
		blogData.tags.map((tag) => (
			<span class={`${tagLink}`} title={tag}>
				{tag}
			</span>
		))
	}
	<h6 style={{ marginBottom: '0px', marginTop: '0px' }}>
		{blogData.description}
		<FastArrowRight style={{ top: '3px', position: 'relative' }} />
	</h6>
</Tile>
