---
/**
 * A regular tile but pre-filled with series metadata.
 *
 * Currently this is hidden and just used for filtering.
 */
import { processEntry, type ProcessedEntry } from 'src/util/collection'
import { makeHash } from 'src/util/names'
import type { CollectionEntry } from 'astro:content'
import FastArrowRight from '~icons/iconoir/fast-arrow-right'
import { generateExcerpt } from 'src/util/helpers'
import TextContainer from '../TextContainer.astro'

interface Props {
	series: CollectionEntry<'series'> | ProcessedEntry<'series'>
}

const { series } = Astro.props

// Type guard: ProcessedEntry has an 'extra' property, CollectionEntry doesn't
const isProcessedEntry = (
	entry: CollectionEntry<'series'> | ProcessedEntry<'series'>
): entry is ProcessedEntry<'series'> => {
	return 'extra' in entry
}

const processedEntry: ProcessedEntry<'series'> = isProcessedEntry(series) ? series : await processEntry(series)
const seriesData = processedEntry.entry.data
const seriesExtra = processedEntry.extra
const id = processedEntry.entry.id
---

<div
	id={id}
	style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%' }}
	class={`seriesTile`}
	data-sidebarid={makeHash(id)}
	data-title={seriesData.title}
	data-rowheight="0"
>
	<TextContainer fontSize="16px" light={true} style={{ borderRadius: '10px' }}>
		<h3 style={{ paddingBottom: 0 }}>
			<a href={seriesExtra.absolutePath}>SERIES: {seriesData.title} ({seriesExtra.gigCount} gigs)</a>
		</h3>
		{
			seriesData.description && (
				<p style={{ maxHeight: '100px', overflow: 'hidden', textOverflow: 'ellipsis', paddingTop: 0 }}>
					{generateExcerpt(seriesData.description, 50)}
				</p>
			)
		}
		<a href={seriesExtra.absolutePath}>More <FastArrowRight style={{ top: '3px', position: 'relative' }} /></a>
	</TextContainer>
</div>
