---
import GigsMenu from 'src/components/gig/GigsMenu.astro'
import SearchBox from 'src/components/SearchBox.astro'
import ShuffleFilters from 'src/components/ShuffleFilters.astro'
import SidebarLayout from 'src/layouts/base/SidebarLayout.astro'
import Gig from 'src/layouts/collection/Gig.astro'
import { loadAndFormatCollection } from 'src/util/collection.ts'

export async function getStaticPaths() {
	const entries = await loadAndFormatCollection('gig')
	return entries.map((entry) => ({
		params: { slug: entry.extra.slug },
		props: {
			entry
		}
	}))
}

const { entry } = Astro.props
const entryData = entry.entry.data
const entryExtra = entry.extra
---

<SidebarLayout
	scrollContext="gigs"
	poo={{
		title: entryData.title,
		description: entryExtra.metaDescription,
		image: entryExtra.cover?.src,
		date: entryData.date.toISOString()
	}}
>
	<ShuffleFilters slot="subheaderTopDesktop" itemselector=".tile" boardselector="#artist-grid">
		<SearchBox placeholder=`Search gigs by title, artist, venue` />
	</ShuffleFilters>
	<GigsMenu slot="sidebarMenu" selected={entry.entry.id} transition:name={'gigs'} transition:persist />
	<ShuffleFilters
		slot="sidebarSubheaderMobile"
		className="fullWidth"
		itemselector=".sidebar-item"
		boardselector="#shuffle-menu"
	>
		<SearchBox placeholder=`Search gigs by title, artist, venue` />
	</ShuffleFilters>
	<Gig entry={entry} slot="content" />
</SidebarLayout>
